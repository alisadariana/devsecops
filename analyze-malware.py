#!/usr/bin/env python3
"""
Simple Static Code Analyzer
"""

import os
import sys
import json
from pathlib import Path

def analyze_file(filepath):
    """Simple analysis of Python file"""
    try:
        with open(filepath, 'r', encoding='utf-8', errors='ignore') as f:
            content = f.read()
    except Exception as e:
        return {'error': str(e), 'risk_level': 'unknown', 'total_score': 0}

    results = {
        'file': str(filepath),
        'suspicious_patterns': [],
        'risk_level': 'low',
        'total_score': 0
    }

    # Check for dangerous imports
    dangerous_imports = ['subprocess', 'socket', 'os.system', 'eval', 'exec']
    for imp in dangerous_imports:
        if imp in content:
            results['suspicious_patterns'].append(f"Found: {imp}")
            results['total_score'] += 10

    # Check for hardcoded secrets
    secret_patterns = ['password', 'api_key', 'secret', 'token']
    for pattern in secret_patterns:
        if pattern.lower() in content.lower():
            results['suspicious_patterns'].append(f"Potential secret: {pattern}")
            results['total_score'] += 15

    # Check for network operations
    if 'socket' in content or 'requests' in content or 'urllib' in content:
        results['suspicious_patterns'].append("Network operations detected")
        results['total_score'] += 20

    # Check for file operations
    if 'open(' in content or 'remove' in content or 'rename' in content:
        results['suspicious_patterns'].append("File operations detected")
        results['total_score'] += 5

    # Determine risk level
    if results['total_score'] >= 70:
        results['risk_level'] = 'high'
    elif results['total_score'] >= 40:
        results['risk_level'] = 'medium'
    else:
        results['risk_level'] = 'low'

    return results

def main():
    if len(sys.argv) < 2:
        print("Usage: analyze-malware.py <file>")
        sys.exit(1)

    filepath = sys.argv[1]

    # Analyze the file
    results = analyze_file(filepath)

    # Print results
    print(json.dumps(results, indent=2))

if __name__ == '__main__':
    main()