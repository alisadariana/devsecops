rule suspicious_python_imports
{
    meta:
        description = "Detects suspicious Python imports commonly used in malware"
        author = "DevSecOps Analyzer"
        severity = "medium"

    strings:
        $import_subprocess = "import subprocess"
        $import_socket = "import socket"
        $import_os_system = "os.system"
        $import_os_exec = "os.exec"
        $import_urllib = "import urllib"
        $import_requests = "import requests"
        $import_ftplib = "import ftplib"

    condition:
        any of them
}

rule dangerous_python_functions
{
    meta:
        description = "Detects dangerous Python functions"
        author = "DevSecOps Analyzer"
        severity = "high"

    strings:
        $eval = "eval("
        $exec = "exec("
        $compile = "compile("
        $import_func = "__import__("
        $globals = "globals()"
        $locals = "locals()"

    condition:
        any of them
}

rule hardcoded_credentials
{
    meta:
        description = "Detects potential hardcoded credentials"
        author = "DevSecOps Analyzer"
        severity = "high"

    strings:
        $password = /password\s*=\s*["'][^"']{4,}["']/
        $api_key = /api_key\s*=\s*["'][^"']{10,}["']/
        $secret = /secret\s*=\s*["'][^"']{4,}["']/
        $token = /token\s*=\s*["'][^"']{10,}["']/

    condition:
        any of them
}

rule network_indicators
{
    meta:
        description = "Detects suspicious network activity patterns"
        author = "DevSecOps Analyzer"
        severity = "medium"

    strings:
        $localhost = "127.0.0.1"
        $suspicious_domain = /\.onion/
        $pastebin = "pastebin.com"
        $transfer_sh = "transfer.sh"
        $raw_github = "raw.githubusercontent.com"

    condition:
        any of them
}

rule file_operations
{
    meta:
        description = "Detects suspicious file operations"
        author = "DevSecOps Analyzer"
        severity = "medium"

    strings:
        $etc_passwd = "/etc/passwd"
        $etc_shadow = "/etc/shadow"
        $ssh_keys = "~/.ssh"
        $temp_files = "tempfile"
        $mkstemp = "mkstemp"

    condition:
        any of them
}

rule obfuscation_techniques
{
    meta:
        description = "Detects code obfuscation techniques"
        author = "DevSecOps Analyzer"
        severity = "high"

    strings:
        $base64_decode = "base64.b64decode"
        $zlib_decompress = "zlib.decompress"
        $gzip_decompress = "gzip.decompress"
        $rot13 = "rot13"
        $xor = "xor"
        $chr_ord = "chr(" / ord("

    condition:
        2 of them
}

rule anti_analysis
{
    meta:
        description = "Detects anti-analysis techniques"
        author = "DevSecOps Analyzer"
        severity = "high"

    strings:
        $debugger_check = "sys.gettrace"
        $virtual_machine = "virtual" nocase
        $sandbox = "sandbox" nocase
        $analysis = "analysis" nocase
        $debugger_present = "debugger"
        $vmware = "vmware" nocase
        $virtualbox = "virtualbox" nocase

    condition:
        any of them
}